# Internationalization (i18n) Instructions

**Project:** YouTube Media Player - Multi-Language Support  
**Purpose:** Support multiple languages and locales  
**Scope:** Frontend UI, error messages, backend responses

---

## üåç What is i18n?

**Internationalization (i18n)** prepares your app for multiple languages and regions.

### Key Concepts

- **Translation keys**: `player.play` ‚Üí "Play" / "Reproducir" / "ÂÜçÁîü"
- **Pluralization**: "1 song" vs "5 songs"
- **Number/Date formatting**: "1,000.50" (US) vs "1.000,50" (DE)
- **RTL support**: Arabic, Hebrew (right-to-left)
- **Language detection**: Browser, localStorage, URL

---

## üì¶ Frontend Setup (react-i18next)

### 1. Install Dependencies

```bash
cd frontend
pnpm add react-i18next i18next i18next-browser-languagedetector
```

### 2. Initialize i18n

```typescript
// frontend/src/i18n/config.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

import en from './locales/en.json';
import es from './locales/es.json';
import de from './locales/de.json';
import ja from './locales/ja.json';

i18n
  .use(LanguageDetector) // Auto-detect user language
  .use(initReactI18next) // React integration
  .init({
    resources: {
      en: { translation: en },
      es: { translation: es },
      de: { translation: de },
      ja: { translation: ja },
    },
    fallbackLng: 'en',
    debug: import.meta.env.DEV,
    
    interpolation: {
      escapeValue: false, // React escapes by default
    },
    
    detection: {
      order: ['localStorage', 'navigator'],
      caches: ['localStorage'],
      lookupLocalStorage: 'i18nextLng',
    },
  });

export default i18n;
```

### 3. Add to App Entry

```typescript
// frontend/src/main.tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import './i18n/config'; // Initialize before App
import App from './App';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

---

## üìù Translation Files

### English (en.json)

```json
{
  "common": {
    "appName": "Media Player",
    "loading": "Loading...",
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "search": "Search",
    "settings": "Settings"
  },
  "player": {
    "play": "Play",
    "pause": "Pause",
    "next": "Next",
    "previous": "Previous",
    "shuffle": "Shuffle",
    "repeat": "Repeat",
    "volume": "Volume",
    "mute": "Mute",
    "unmute": "Unmute",
    "seek": "Seek"
  },
  "library": {
    "title": "Library",
    "allMedia": "All Media",
    "favorites": "Favorites",
    "recentlyPlayed": "Recently Played",
    "frequentlyPlayed": "Frequently Played",
    "empty": "Your library is empty",
    "emptyDescription": "Download some music to get started",
    "itemCount": "{{count}} item",
    "itemCount_plural": "{{count}} items"
  },
  "playlist": {
    "create": "Create Playlist",
    "edit": "Edit Playlist",
    "delete": "Delete Playlist",
    "name": "Playlist Name",
    "addTrack": "Add to Playlist",
    "removeTrack": "Remove from Playlist",
    "trackCount": "{{count}} track",
    "trackCount_plural": "{{count}} tracks"
  },
  "download": {
    "title": "Download",
    "urlPlaceholder": "Paste YouTube URL",
    "videoQuality": "Video Quality",
    "audioOnly": "Audio Only",
    "downloading": "Downloading...",
    "complete": "Download Complete",
    "failed": "Download Failed",
    "progress": "{{percent}}% - {{speed}} - {{eta}} remaining"
  },
  "errors": {
    "invalidUrl": "Invalid YouTube URL",
    "networkError": "Network error occurred",
    "notFound": "Media not found",
    "unauthorized": "Unauthorized access",
    "serverError": "Server error occurred",
    "tryAgain": "Please try again"
  },
  "time": {
    "justnow": "just now",
    "minutesAgo": "{{count}} minute ago",
    "minutesAgo_plural": "{{count}} minutes ago",
    "hoursAgo": "{{count}} hour ago",
    "hoursAgo_plural": "{{count}} hours ago",
    "daysAgo": "{{count}} day ago",
    "daysAgo_plural": "{{count}} days ago"
  }
}
```

### Spanish (es.json)

```json
{
  "common": {
    "appName": "Reproductor de Medios",
    "loading": "Cargando...",
    "save": "Guardar",
    "cancel": "Cancelar",
    "delete": "Eliminar",
    "search": "Buscar",
    "settings": "Configuraci√≥n"
  },
  "player": {
    "play": "Reproducir",
    "pause": "Pausar",
    "next": "Siguiente",
    "previous": "Anterior",
    "shuffle": "Aleatorio",
    "repeat": "Repetir",
    "volume": "Volumen",
    "mute": "Silenciar",
    "unmute": "Activar sonido",
    "seek": "Buscar"
  },
  "library": {
    "title": "Biblioteca",
    "allMedia": "Todos los Medios",
    "favorites": "Favoritos",
    "recentlyPlayed": "Reproducidos Recientemente",
    "frequentlyPlayed": "Reproducidos Frecuentemente",
    "empty": "Tu biblioteca est√° vac√≠a",
    "emptyDescription": "Descarga m√∫sica para comenzar",
    "itemCount": "{{count}} elemento",
    "itemCount_plural": "{{count}} elementos"
  }
}
```

---

## üé® Using Translations in Components

### Basic Usage

```tsx
// frontend/src/components/Player/Controls.tsx
import { useTranslation } from 'react-i18next';

export const Controls: React.FC = () => {
  const { t } = useTranslation();
  
  return (
    <div>
      <button>{t('player.play')}</button>
      <button>{t('player.pause')}</button>
      <button>{t('player.next')}</button>
      <button>{t('player.previous')}</button>
    </div>
  );
};
```

### Interpolation

```tsx
const { t } = useTranslation();

// With variables
<p>{t('download.progress', { 
  percent: 75, 
  speed: '5.2 MB/s', 
  eta: '30s' 
})}</p>
// Output: "75% - 5.2 MB/s - 30s remaining"
```

### Pluralization

```tsx
const { t } = useTranslation();

<p>{t('library.itemCount', { count: items.length })}</p>
// count: 1 ‚Üí "1 item"
// count: 5 ‚Üí "5 items"
```

### Formatted Dates

```tsx
import { useTranslation } from 'react-i18next';

const { i18n } = useTranslation();
const date = new Date();

// Locale-aware formatting
const formatted = date.toLocaleDateString(i18n.language, {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
```

---

## üîß Language Switcher

```tsx
// frontend/src/components/LanguageSwitcher.tsx
import { useTranslation } from 'react-i18next';

const languages = [
  { code: 'en', name: 'English', flag: 'üá∫üá∏' },
  { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },
  { code: 'de', name: 'Deutsch', flag: 'üá©üá™' },
  { code: 'ja', name: 'Êó•Êú¨Ë™û', flag: 'üáØüáµ' },
];

export const LanguageSwitcher: React.FC = () => {
  const { i18n } = useTranslation();
  
  const changeLanguage = (lng: string) => {
    i18n.changeLanguage(lng);
    // Persisted automatically to localStorage
  };
  
  return (
    <select 
      value={i18n.language} 
      onChange={(e) => changeLanguage(e.target.value)}
    >
      {languages.map((lang) => (
        <option key={lang.code} value={lang.code}>
          {lang.flag} {lang.name}
        </option>
      ))}
    </select>
  );
};
```

---

## üåê Backend i18n (Error Messages)

### Setup

```bash
cd backend
pnpm add i18next i18next-fs-backend
```

```typescript
// backend/src/i18n/config.ts
import i18next from 'i18next';
import Backend from 'i18next-fs-backend';
import path from 'path';

i18next
  .use(Backend)
  .init({
    backend: {
      loadPath: path.join(__dirname, 'locales/{{lng}}.json'),
    },
    fallbackLng: 'en',
    preload: ['en', 'es', 'de', 'ja'],
  });

export default i18next;
```

### Translated Error Responses

```typescript
// backend/src/middleware/error.middleware.ts
import i18next from '../i18n/config';

export const errorHandler = (err: any, req: any, res: any, next: any) => {
  const lang = req.headers['accept-language']?.split(',')[0] || 'en';
  
  const message = i18next.t(`errors.${err.code}`, { 
    lng: lang,
    defaultValue: err.message 
  });
  
  res.status(err.statusCode || 500).json({
    success: false,
    error: {
      code: err.code,
      message,
      timestamp: new Date().toISOString(),
    },
  });
};
```

---

## üìê RTL (Right-to-Left) Support

```tsx
// frontend/src/App.tsx
import { useTranslation } from 'react-i18next';
import { useEffect } from 'react';

export const App = () => {
  const { i18n } = useTranslation();
  
  useEffect(() => {
    // Set dir attribute based on language
    const isRTL = ['ar', 'he', 'fa'].includes(i18n.language);
    document.dir = isRTL ? 'rtl' : 'ltr';
  }, [i18n.language]);
  
  return <div>{/* App content */}</div>;
};
```

```css
/* CSS for RTL support */
[dir='rtl'] .player-controls {
  flex-direction: row-reverse;
}

[dir='rtl'] .sidebar {
  left: auto;
  right: 0;
}
```

---

## ‚úÖ Best Practices

1. **Use namespaces** - Group keys logically (`player.play`, `library.empty`)
2. **Avoid hardcoded text** - Always use translation keys
3. **Pluralization rules** - Use `_plural` suffix for count-based translations
4. **Context-specific keys** - `button.save` vs `toast.saved`
5. **Fallback language** - Always have English as fallback
6. **Test all languages** - Verify UI doesn't break with long translations
7. **Extract strings early** - Don't wait until after implementation
8. **Professional translation** - Use translation services for production

---

## üõ†Ô∏è Development Workflow

```bash
# Check for missing translations
pnpm run i18n:check

# Extract new keys from code
pnpm run i18n:extract

# Validate translation files
pnpm run i18n:validate
```

Script to find missing keys:

```typescript
// scripts/check-i18n.ts
import en from '../src/i18n/locales/en.json';
import es from '../src/i18n/locales/es.json';

function flattenKeys(obj: any, prefix = ''): string[] {
  return Object.keys(obj).flatMap(key => {
    const value = obj[key];
    const newKey = prefix ? `${prefix}.${key}` : key;
    return typeof value === 'object' ? flattenKeys(value, newKey) : newKey;
  });
}

const enKeys = flattenKeys(en);
const esKeys = flattenKeys(es);

const missing = enKeys.filter(key => !esKeys.includes(key));
console.log('Missing Spanish translations:', missing);
```

---

**Related Documentation:**
- `frontend.instructions.md` - Frontend setup
- `ux-design.instructions.md` - User experience

---

**End of i18n Instructions**
